"use strict";!function(e){var t={URL:"/jslog",METHOD:"POST",EXCEPTION_PRETEXT:"APPLE ID : ",LOG_LEVEL:"ERROR",ALLOWED_LOG_LEVELS:["ERROR","DEBUG","OFF","INFO"],WARN_CAPTURE_CONSOLE_COLOR:"background: #FFF0F0; color: red",NAMESPACE_FOR_PM:"pmrpc.",POST_MESSAGE_LOG_STATUS:"ON"},n=t.URL,i=t.LOG_LEVEL,o=t.NAMESPACE_FOR_PM,r="",s="",a=t.POST_MESSAGE_LOG_STATUS,p=function(e){this.name="IllegalLogException",this.message=t.EXCEPTION_PRETEXT+e,this.stack=(new Error).stack},g=function(e,t){if(e&&"string"==typeof e&&t&&"string"==typeof t)try{window.sessionStorage&&sessionStorage.setItem(e,t)}catch(n){}},c=function(e){var t=" type, title, message are mandatory. ";if("undefined"==typeof e)throw new p("logObject is not defined.");if("undefined"==typeof e.type)throw new p("logObject.type is not defined."+t);if("undefined"==typeof e.title)throw new p("logObject.title is not defined."+t);if("undefined"==typeof e.message)throw new p("logObject.message is not defined."+t);return!0},d=function(e){if(!e)throw new p("Invalid endpoint URL: "+e);return!0},f=function(e){d(e)&&(n=e)},E=function(){return n},l=function(e){e&&"string"==typeof e&&e.toUpperCase().trim()&&-1!==t.ALLOWED_LOG_LEVELS.indexOf(e.toUpperCase().trim())&&(i=e.toUpperCase().trim())},O=function(e){return i},u=function(e){if(!e||"NULL"===e.toString().toUpperCase().trim()||"UNDEFINED"===e.toString().toUpperCase().trim())throw new p("SCNT token is not valid.");r=e},L=function(e){if(!e||"NULL"===e.toString().toUpperCase().trim()||"UNDEFINED"===e.toString().toUpperCase().trim())throw new p("CSRF token is not valid.");s=e},S=function(e,o){if(c(e)){var a=function(){g(t.EXCEPTION_PRETEXT,"Logging transaction failed or cancelled at."+n)};e.message=t.EXCEPTION_PRETEXT+e.message,"undefined"!=typeof e.details?e.details.pageVisibilityState=document.visibilityState:e.details={pageVisibilityState:document.visibilityState},e.details&&(e.details=JSON.stringify(e.details)),o&&u(o);try{var p=new XMLHttpRequest;p.open(t.METHOD,n,!0),p.setRequestHeader("Content-type","application/json"),p.setRequestHeader("Accept","application/json"),p.setRequestHeader("scnt",r),p.setRequestHeader("x-csrf-token",s),p.addEventListener("error",a),p.addEventListener("abort",a),p.onreadystatechange=function(){204!==p.status},"OFF"!==i&&("INFO"===i||"ERROR"===i?("ERROR"===e.type.toUpperCase().trim()||"INFO"===e.type.toUpperCase().trim())&&p.send(JSON.stringify(e)):"DEBUG"===i&&p.send(JSON.stringify(e)))}catch(d){}}},y=function(e){setTimeout(function(){throw e},0)},R=function(){return o},m=function(e){"string"==typeof e&&e.trim()&&(o=e)},N=function(){return a},T=function(e){a="string"==typeof e&&e.trim()&&-1!==["ON","OFF"].indexOf(e.toUpperCase().trim())?e.toUpperCase().trim():t.POST_MESSAGE_LOG_STATUS},w={log:S,onerror:y,getLoggingEndpoint:E,setLoggingEndpoint:f,setGlobalLogLevel:l,getGlobalLogLevel:O,setSCNT:u,setCSRF:L,getNamespaceForPM:R,setNamespaceForPM:m,getPMLoggingStatus:N,setPMLoggingStatus:T};p.prototype=Object.create(Error.prototype),p.prototype.constructor=p,e.AppleID=e.AppleID||{},e.AppleID.service=e.AppleID.service||{},e.AppleID.service.JSLogger=e.AppleID.service.JSLogger||w,window.onerror=function(n,i,r,s,p){if("ON"===a){var g=parseInt(1e16*Math.random()).toString(),c={jsonrpc:"2.0",method:"log",params:[{data:"AppleAuth failed to load."}],id:g};window.parent.postMessage(o+JSON.stringify(c),"*")}e.AppleID.service.JSLogger.log({title:p&&(p.name||"ERROR"),type:t.LOG_LEVEL,message:n,stacktrace:p&&(p.stack||JSON.stringify(p)),details:{file:i,lineno:r,colno:s,caught:"NO"}})}}(window),function(){try{window.AppleID.service.JSLogger.setLoggingEndpoint("/appleauth/jslog")}catch(e){}}();
